# CarDD Model Configuration

# Dataset Configuration
dataset:
  name: "CarDD"
  root_dir: "CarDD_release"
  coco_dir: "CarDD_release/CarDD_COCO"
  sod_dir: "CarDD_release/CarDD_SOD"
  
  train_ann: "CarDD_release/CarDD_COCO/annotations/instances_train2017.json"
  val_ann: "CarDD_release/CarDD_COCO/annotations/instances_val2017.json"
  test_ann: "CarDD_release/CarDD_COCO/annotations/instances_test2017.json"
  
  train_img_dir: "CarDD_release/CarDD_COCO/train2017"
  val_img_dir: "CarDD_release/CarDD_COCO/val2017"
  test_img_dir: "CarDD_release/CarDD_COCO/test2017"
  
  num_classes: 6
  classes:
    - "dent"
    - "scratch"
    - "crack"
    - "glass shatter"
    - "lamp broken"
    - "tire flat"

# Model Configuration
model:
  architecture: "yolov8"  # Options: yolov8, faster_rcnn, mask_rcnn, deformable_detr
  backbone: "yolov8x"  # yolov8n, yolov8s, yolov8m, yolov8l, yolov8x
  pretrained: true
  use_segmentation: true
  
  # YOLOv8 specific
  yolo:
    img_size: 640
    conf_threshold: 0.25
    iou_threshold: 0.45
    max_det: 300
  
  # Mask R-CNN specific
  mask_rcnn:
    backbone: "resnet101"
    fpn: true
    min_size: 800
    max_size: 1333
  
  # Deformable DETR specific
  detr:
    num_queries: 300
    hidden_dim: 256
    nheads: 8
    num_encoder_layers: 6
    num_decoder_layers: 6

# Training Configuration
training:
  epochs: 100
  batch_size: 16
  num_workers: 4
  device: "cuda"
  
  # Optimizer
  optimizer:
    type: "AdamW"  # Options: Adam, AdamW, SGD
    lr: 0.001
    weight_decay: 0.0001
    momentum: 0.9  # for SGD
  
  # Learning Rate Scheduler
  scheduler:
    type: "cosine"  # Options: cosine, step, plateau, onecycle
    warmup_epochs: 3
    min_lr: 0.00001
    
  # Loss weights
  loss:
    cls_weight: 1.0
    box_weight: 5.0
    obj_weight: 1.0
    seg_weight: 1.0
  
  # Mixed precision training
  use_amp: true
  gradient_clip: 10.0
  
  # Checkpointing
  save_dir: "checkpoints"
  save_period: 5
  save_best_only: false
  
  # Early stopping
  patience: 20
  min_delta: 0.001

# Data Augmentation
augmentation:
  train:
    - type: "HorizontalFlip"
      p: 0.5
    - type: "VerticalFlip"
      p: 0.2
    - type: "RandomRotate90"
      p: 0.3
    - type: "ShiftScaleRotate"
      shift_limit: 0.1
      scale_limit: 0.2
      rotate_limit: 30
      p: 0.5
    - type: "RandomBrightnessContrast"
      brightness_limit: 0.2
      contrast_limit: 0.2
      p: 0.5
    - type: "HueSaturationValue"
      hue_shift_limit: 20
      sat_shift_limit: 30
      val_shift_limit: 20
      p: 0.3
    - type: "GaussNoise"
      var_limit: [10, 50]
      p: 0.2
    - type: "Blur"
      blur_limit: 3
      p: 0.2
    - type: "CLAHE"
      p: 0.2
    - type: "CoarseDropout"
      max_holes: 8
      max_height: 32
      max_width: 32
      p: 0.3
  
  val:
    - type: "Resize"
      height: 640
      width: 640

# Evaluation
evaluation:
  metrics:
    - "AP"
    - "AP50"
    - "AP75"
    - "mAP"
    - "precision"
    - "recall"
    - "f1_score"
  
  iou_thresholds: [0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95]
  conf_threshold: 0.25
  nms_threshold: 0.45

# Logging
logging:
  use_wandb: true
  project_name: "CarDD-Detection"
  experiment_name: "yolov8x_experiment"
  log_interval: 10
  log_images: true
  num_log_images: 16
  
  use_tensorboard: true
  tensorboard_dir: "runs"

# Inference
inference:
  conf_threshold: 0.25
  iou_threshold: 0.45
  save_visualizations: true
  output_dir: "outputs"
  show_labels: true
  show_conf: true
  line_thickness: 2
  font_scale: 0.5
